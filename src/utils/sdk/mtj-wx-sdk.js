!function(){"use strict";var c="1.4.0",a={ns:null,boxjs:null},r={},s={},i={logServerUrl:"https://hmma.baidu.com/mini.gif",maxRequestRetryCount:5,requestRetryFirstDelay:1e3,requestRetryMultiple:4,maxRequestDataLength:204800,maxUint8:255,maxUint32:4294967295,enabledEvents:{app:["show","hide","error"],page:["show","hide","ready"],share:["action","success","fail"],event:"*"},storageKeys:{appId:"mtj_appid",key:"mtj_key",uuid:"mtj_uuid",shareCount:"mtj_scnt"}},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,a=!1,o=void 0;try{for(var c,s=t[Symbol.iterator]();!(r=(c=s.next()).done)&&(n.push(c.value),!e||n.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},f=function(){return"undefined"!=typeof crypto&&crypto.getRandomValues?crypto.getRandomValues(new Uint32Array(1))[0]:Math.floor(Math.random()*i.maxUint32)},l=function(t,e){return"[object "+e+"]"==={}.toString.call(t)},p=function n(r){return(l(r,"Object")||l(r,"Array"))&&Object.keys(r).forEach(function(t){var e=r[t];l(e,"Object")||l(e,"Array")?r[t]=n(e):r[t]=""+e}),r},h=new Set,d=[],e=function(t){var e;(t.data=t.data||{},t.data.v=c,e=t.data,JSON.stringify(e).length<=i.maxRequestDataLength)?function e(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:i.requestRetryFirstDelay;return a.ns.request({url:n.url,data:n.data,header:Object.assign({"content-type":"application/json"},n.header),method:n.method||"POST",dataType:n.dataType||"json",success:function(t){delete n.data.rtc,n.success&&n.success(t)},fail:function(t){n.data.rtc=(n.data.rtc||0)+1,n.data.rtc<=i.maxRequestRetryCount?setTimeout(function(){return e(n,r*i.requestRetryMultiple)},r):(n.data.rtc=0,n.fail&&n.fail(t))}})}(t):t.fail&&t.fail(new Error("invalid data"))},y=function(){return h.has("app.launch")&&h.has("app.show")},g=function(){d.forEach(function(t){"app"===t.data.et&&"show"===t.data.en||(t.data.rqc++,r.rqc++),t.data=Object.assign({},r,"event"===t.data.et||"show"===t.data.en?s:{},t.data),e(t)}),d.length=0},m={sendRequest:e,trackEvent:function(t){var e=this;if(h.add(t.et+"."+t.en),"app"===t.et&&"launch"===t.en&&y()&&g(),"*"===i.enabledEvents[t.et]||-1!==i.enabledEvents[t.et].indexOf(t.en)){r.rqc=(r.rqc||0)+1,t.rid=f(),t.aso=t.aso||{};var n={url:i.logServerUrl,dataType:"string",data:Object.assign({},r,t),fail:function(t){return e.trackError("sendRequest",t)}};y()?(this.sendRequest(n),"app"===t.et&&"show"===t.en&&g()):(n.data.rqc=r.rqc,r.path&&(n.data.path=r.path),r.query&&(n.data.query=r.query),d.push(n))}},trackError:function(t,e){r.rqc=(r.rqc||0)+1;var n=l(e,"Object")?JSON.stringify(p(e)):""+e;this.sendRequest({url:i.logServerUrl,dataType:"string",data:Object.assign({},r,{et:"error",en:t,ep:{ex:n},rid:f()})})},clearTrackedEvents:function(){h.clear()},ubcLog:function(t){a.boxjs.boxjs.log({name:"ubcFlowJar",data:[t]})}},v=function(t){try{return a.ns.getStorageSync(t)}catch(t){m.trackError("getStorageSync",t)}},S=function(t,e){try{a.ns.setStorageSync(t,e)}catch(t){m.trackError("setStorageSync",t)}},n=function(){var t=v(i.storageKeys.uuid);return l(t,"String")&&32===t.length?t:(t=([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,function(t){return(t^("undefined"!=typeof crypto&&crypto.getRandomValues?crypto.getRandomValues(new Uint8Array(1))[0]:Math.floor(Math.random()*i.maxUint8))&15>>t/4).toString(16)}),S(i.storageKeys.uuid,t),t||"")},b=function(n){return new Promise(function(e,t){if(!n)return e();try{a.ns.getShareInfo({shareTicket:n,success:function(t){delete t.errMsg,e(t)},fail:function(t){e({})}})}catch(t){m.trackError("getShareInfo",t),e({})}})},k={onLaunch:function(){var t=require("./mtj-wx-sdk.config");if(t.appKey)return r.key=t.appKey,r.uuid=n(),Promise.all([new Promise(function(e,t){try{a.ns.getSetting({success:function(t){t.authSetting&&t.authSetting["scope.userInfo"]?a.ns.checkSession({success:function(t){t&&!1===t.result?e({}):a.ns.getUserInfo({success:function(t){delete t.userInfo.errMsg,e(t.userInfo)},fail:function(){e({})}})},fail:function(){e({})}}):e({})},fail:function(){e({})}})}catch(t){m.trackError("getUserInfo",t),e({})}}),new Promise(function(e,t){try{a.ns.getSystemInfo({success:function(t){delete t.errMsg,e(t)},fail:function(t){e({})}})}catch(t){m.trackError("getSystemInfo",t),e({})}}),new Promise(function(e,t){try{a.ns.getNetworkType({success:function(t){delete t.errMsg,e(t)},fail:function(t){e({})}})}catch(t){m.trackError("getNetworkType",t),e({})}}),t.getLocation?new Promise(function(e,t){try{a.ns.getLocation({type:"wgs84",success:function(t){delete t.errMsg,e(t)},fail:function(t){e({})}})}catch(t){m.trackError("getLocation",t),e({})}}):Promise.resolve()]).then(function(t){var e=u(t,4),n=e[0],r=e[1],a=e[2],o=e[3];s.user=p(n),s.system=p(r),s.network=p(a),o&&(s.location=p(o)),"devtools"===r.platform&&i.latestVersion&&function(t,e){for(var n=t.split("."),r=e.split("."),a=0;a<3;a++){var o=+n[a]||0,c=+r[a]||0;if(c<o)return 1;if(o<c)return-1}return 0}(c,i.latestVersion)<0&&console.warn("百度移动统计微信小程序SDK已更新，为不影响您的正常使用，请到SDK下载中心（https://mtj.baidu.com/web/sdk/index）下载最新版本"),m.trackEvent({et:"app",en:"launch"})}).catch(function(t){return m.trackError("app onLaunch",t)});console.error("请设置mtj-wx-sdk.config.js文件中的appKey字段")},onShow:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};s.aso=s.aso||{},(l(r.sid,"Undefined")||e.scene&&s.aso.scene!==""+e.scene)&&(r.sid=f(),r.rqc=0),s.aso.scene=""+e.scene,e.referrerInfo&&e.referrerInfo.appId&&(s.aso.referrerInfo=e.referrerInfo),r.path=s.aso.path=e.path,r.query=s.aso.query=Object.keys(e.query).map(function(t){return{key:t,value:e.query[t]}}),b(e.shareTicket).then(function(t){t&&(s.aso.shareInfo=t),m.trackEvent(Object.assign({et:"app",en:"show"},s))})},onHide:function(){m.trackEvent({et:"app",en:"hide"})},onError:function(t){var e=l(t,"Object")?JSON.stringify(p(t)):""+t;m.trackEvent({et:"app",en:"error",ep:{ex:e}})}},w=function(t,e){m.trackEvent({et:"page",en:t,ep:e})},E={onLoad:function(){w("load")},onShow:function(){var t=getCurrentPages(),e=t[t.length-1];r.path=e.route,r.query=Object.keys(e.options).map(function(t){return{key:t,value:e.options[t]}}),m.trackEvent(Object.assign({et:"page",en:"show"},s))},onReady:function(){w("ready")},onHide:function(){w("hide")},onUnload:function(){w("unload")},onPullDownRefresh:function(){w("pullDownRefresh")},onReachBottom:function(){w("reachBottom")},onPageScroll:function(){w("pageScroll")},onTabItemTap:function(t){w("tabItemTap",t)},onShareAppMessage:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=v(i.storageKeys.shareCount);n=(Number.isInteger(n)?n:0)+1,S(i.storageKeys.shareCount,n);var r={cnt:n,from:t.from,path:e.path||""};e.title&&(r.title=""+e.title),t.target&&(r.target=JSON.stringify(t.target)),m.trackEvent(Object.assign({et:"share",en:"action",ep:r},s));var a=e.success;e.success=function(t){E.shareSuccess(t),a&&a(t)};var o=e.fail;return e.fail=function(t){E.shareFail(t),o&&o(t)},e},shareSuccess:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=[].concat(t.shareTickets);Promise.all(e.map(function(t){return b(t)})).then(function(t){t&&t[0]||(t=[]),m.trackEvent({et:"share",en:"success",ep:t})})},shareFail:function(t){m.trackEvent({et:"share",en:"fail",ep:{ex:JSON.stringify(t)}})}},j=function(t){if(e=t.reportName,l(e,"String")&&/^[a-z][a-z0-9_]{0,31}$/.test(e)){var e,r=t.reportParams||{},n=Object.keys(r).filter(function(t){return l(n=t,"String")&&/^[a-z0-9_]{1,32}$/.test(n)&&(e=r[t],l(e,"String")||l(e,"Number"));var e,n}).map(function(t){return{key:""+t,value:""+r[t],type:o(r[t])}});m.trackEvent(Object.assign({et:"event",en:""+t.reportName,ep:{data:n}},s))}},q=function(t,e,n){var r=e[t];e[t]=function(t){n.call(this,t),r&&r.call(this,t)}};!function(){r.type=1,a.ns=wx;var t=App;App=function(e){["onLaunch","onShow","onHide","onError"].forEach(function(t){q(t,e,k[t])}),e.mtj={trackEvent:function(t,e){j({reportName:t,reportParams:e})}},t(e)};var e=Page;Page=function(o){["onLoad","onShow","onHide","onReady"].forEach(function(t){q(t,o,E[t])}),["onShareAppMessage"].forEach(function(t){var e,n,r,a;n=o,r=E[e=t],a=n[e],n[e]=function(t){var e=a&&a.call(this,t);return r.call(this,t,e)}}),e(o)}}()}();
